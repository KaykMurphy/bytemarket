<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ByteMarket | Marketplace Premium de Produtos Digitais</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

    <!-- Bootstrap 5.3 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">

    <!-- Quill Editor -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">

    <!-- SweetAlert2 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">

    <style>
        :root {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-card: #1e293b;
            --bg-glass: rgba(30, 41, 59, 0.7);
            --border-primary: #334155;
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --accent-orange: #f97316;
            --accent-orange-hover: #ea580c;
            --accent-purple: #8b5cf6;
            --accent-cyan: #06b6d4;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --gradient-primary: linear-gradient(135deg, #f97316 0%, #8b5cf6 100%);
            --gradient-secondary: linear-gradient(135deg, #06b6d4 0%, #8b5cf6 100%);
            --shadow-glow: 0 0 20px rgba(139, 92, 246, 0.3);
            --shadow-card: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Scrollbar Personalizada */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--accent-orange);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-orange-hover);
        }

        /* Glassmorphism Effects */
        .glass-card {
            background: var(--bg-glass);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
        }

        /* Navbar Glassmorphism */
        .navbar-glass {
            background: rgba(15, 23, 42, 0.8) !important;
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 1rem 0;
        }

        /* Hero Section */
        .hero-section {
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.9) 0%, rgba(30, 41, 59, 0.9) 100%),
            url('https://images.unsplash.com/photo-1511512578047-dfb367046420?q=80&w=2071&auto=format&fit=crop') center/cover;
            padding: 6rem 0;
            position: relative;
            overflow: hidden;
        }

        .hero-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 20% 50%, rgba(139, 92, 246, 0.1) 0%, transparent 50%),
            radial-gradient(circle at 80% 20%, rgba(6, 182, 212, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        .hero-stats {
            display: flex;
            gap: 3rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 3rem;
        }

        .stat-card {
            text-align: center;
            padding: 1.5rem 2rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            min-width: 150px;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent-orange);
            box-shadow: var(--shadow-glow);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 800;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1;
        }

        /* Category Cards */
        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1.5rem;
            padding: 2rem 0;
        }

        .category-card {
            background: var(--bg-card);
            border-radius: 16px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
        }

        .category-card:hover {
            transform: translateY(-8px);
            border-color: var(--accent-orange);
            box-shadow: var(--shadow-glow);
        }

        .category-card.active {
            border-color: var(--accent-orange);
            box-shadow: var(--shadow-glow);
        }

        .category-image {
            height: 140px;
            width: 100%;
            object-fit: cover;
            background: linear-gradient(45deg, var(--bg-secondary), var(--accent-purple));
        }

        .category-name {
            padding: 1rem;
            text-align: center;
            font-weight: 600;
            font-size: 1.1rem;
        }

        /* Product Cards */
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 2rem;
            padding: 2rem 0;
        }

        @media (min-width: 1400px) {
            .product-grid {
                grid-template-columns: repeat(5, 1fr);
            }
        }

        .product-card {
            background: var(--bg-card);
            border-radius: 16px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.4s ease;
            border: 1px solid var(--border-primary);
            position: relative;
        }

        .product-card:hover {
            transform: translateY(-10px);
            border-color: var(--accent-orange);
            box-shadow: var(--shadow-glow);
        }

        .product-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-primary);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .product-card:hover::before {
            opacity: 1;
        }

        .product-image {
            height: 180px;
            width: 100%;
            object-fit: cover;
            background: var(--bg-secondary);
        }

        .product-body {
            padding: 1.5rem;
        }

        .product-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .product-price {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--accent-orange);
            margin: 0.5rem 0;
        }

        .product-stock {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .product-stock.out {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
        }

        .out-of-stock-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 23, 42, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 16px;
        }

        .out-of-stock-badge {
            background: var(--danger);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-weight: 700;
            transform: rotate(-5deg);
        }

        /* Product Details Page - Trust Layout */
        .product-detail-section {
            padding: 4rem 0;
        }

        .product-image-container {
            position: sticky;
            top: 2rem;
            height: fit-content;
        }

        .product-main-image {
            width: 100%;
            border-radius: 20px;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-card);
        }

        .selected-plan-card {
            background: var(--gradient-primary);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 2rem 0;
            border: 3px solid var(--accent-orange);
            position: relative;
            cursor: pointer;
        }

        .selected-plan-card::before {
            content: "✓ SELECIONADO";
            position: absolute;
            top: -12px;
            left: 20px;
            background: var(--accent-orange);
            color: white;
            padding: 0.3rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .selected-plan-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: white;
            margin-bottom: 0.5rem;
        }

        .selected-plan-price {
            font-size: 2rem;
            font-weight: 800;
            color: white;
        }

        .warning-box {
            background: rgba(245, 158, 11, 0.1);
            border: 2px solid var(--warning);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 2rem 0;
        }

        .warning-title {
            color: var(--warning);
            font-weight: 700;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Checkout Card Sticky */
        .checkout-card-sticky {
            position: sticky;
            top: 2rem;
            background: var(--bg-card);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: var(--shadow-card);
            border: 1px solid var(--border-primary);
        }

        .buy-now-btn {
            background: var(--gradient-primary);
            color: white;
            border: none;
            padding: 1.2rem;
            font-size: 1.2rem;
            font-weight: 700;
            border-radius: 12px;
            width: 100%;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .buy-now-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(249, 115, 22, 0.3);
        }

        .add-to-cart-btn {
            background: transparent;
            color: var(--accent-orange);
            border: 2px solid var(--accent-orange);
            padding: 1rem;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 12px;
            width: 100%;
            transition: all 0.3s ease;
        }

        .add-to-cart-btn:hover {
            background: var(--accent-orange);
            color: white;
        }

        .guarantee-cards {
            display: grid;
            gap: 1rem;
            margin-top: 2rem;
        }

        .guarantee-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: all 0.3s ease;
        }

        .guarantee-card:hover {
            background: rgba(139, 92, 246, 0.1);
            transform: translateX(5px);
        }

        .guarantee-icon {
            font-size: 1.5rem;
            color: var(--accent-cyan);
        }

        /* Related Products */
        .related-products-carousel {
            display: flex;
            gap: 1rem;
            overflow-x: auto;
            padding: 1rem 0;
            scrollbar-width: thin;
        }

        .related-products-carousel::-webkit-scrollbar {
            height: 6px;
        }

        .related-products-carousel::-webkit-scrollbar-track {
            background: var(--bg-secondary);
            border-radius: 3px;
        }

        .related-products-carousel::-webkit-scrollbar-thumb {
            background: var(--accent-orange);
            border-radius: 3px;
        }

        /* Checkout Page */
        .checkout-section {
            padding: 4rem 0;
        }

        .payment-option-card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 1.5rem;
            border: 2px solid var(--border-primary);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .payment-option-card.active {
            border-color: var(--accent-orange);
            background: rgba(249, 115, 22, 0.1);
        }

        .payment-option-card:hover {
            border-color: var(--accent-orange);
        }

        .pix-badge {
            background: var(--success);
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .order-summary-card {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 2rem;
            border: 1px solid var(--border-primary);
        }

        .coupon-input-group {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 0.5rem;
            display: flex;
            gap: 0.5rem;
        }

        /* Admin Styles */
        .admin-section {
            padding: 2rem 0;
        }

        .category-image-preview {
            width: 100px;
            height: 60px;
            object-fit: cover;
            border-radius: 8px;
            margin-top: 0.5rem;
            border: 2px solid var(--border-primary);
        }

        /* Custom Quill Editor */
        .ql-toolbar {
            background: var(--bg-secondary);
            border: 1px solid var(--border-primary) !important;
            border-radius: 8px 8px 0 0;
        }

        .ql-container {
            background: var(--bg-card);
            border: 1px solid var(--border-primary) !important;
            border-radius: 0 0 8px 8px;
            min-height: 200px;
        }

        .ql-editor {
            color: var(--text-primary);
            min-height: 200px;
        }

        /* SPA Screens */
        .screen {
            display: none;
            animation: fadeIn 0.4s ease;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Badge Colors */
        .badge-category {
            background: var(--gradient-secondary);
            color: white;
        }

        .badge-stock {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
            border: 1px solid var(--success);
        }

        /* Loading Spinner */
        .loading-spinner {
            display: inline-block;
            width: 2rem;
            height: 2rem;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top-color: var(--accent-orange);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .hero-section {
                padding: 4rem 0;
            }

            .hero-stats {
                gap: 1rem;
            }

            .stat-card {
                min-width: 120px;
                padding: 1rem;
            }

            .stat-number {
                font-size: 2rem;
            }

            .product-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }

            .checkout-card-sticky {
                position: static;
                margin-top: 2rem;
            }
        }

        /* Custom Form Controls */
        .form-control-custom {
            background: var(--bg-secondary);
            border: 2px solid var(--border-primary);
            color: var(--text-primary);
            border-radius: 12px;
            padding: 0.75rem 1rem;
            transition: all 0.3s ease;
        }

        .form-control-custom:focus {
            background: var(--bg-secondary);
            border-color: var(--accent-orange);
            color: var(--text-primary);
            box-shadow: 0 0 0 3px rgba(249, 115, 22, 0.1);
        }

        /* Dropdown Custom */
        .dropdown-menu-custom {
            background: var(--bg-card);
            border: 1px solid var(--border-primary);
            box-shadow: var(--shadow-card);
            border-radius: 12px;
        }

        .dropdown-item-custom {
            color: var(--text-primary);
            padding: 0.75rem 1rem;
            transition: all 0.3s ease;
        }

        .dropdown-item-custom:hover {
            background: rgba(139, 92, 246, 0.1);
            color: var(--accent-purple);
        }

        /* Cart Count Badge */
        .cart-count-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--accent-orange);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }

        /* Animated Gradient Text */
        .gradient-text {
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
    </style>
</head>
<body>
<!-- Navbar Glassmorphism -->
<nav class="navbar navbar-expand-lg navbar-glass fixed-top">
    <div class="container">
        <a class="navbar-brand fw-bold fs-3 gradient-text" href="#" onclick="showScreen('home')">
            <i class="bi bi-controller me-2"></i>ByteMarket
        </a>

        <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <i class="bi bi-list text-white fs-3"></i>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto align-items-center gap-3">
                <li class="nav-item">
                    <a class="nav-link fw-medium" href="#" onclick="showScreen('home')">Início</a>
                </li>

                <li class="nav-item" id="loginNavBtn">
                    <a class="nav-link fw-medium" href="#" onclick="showScreen('login')">
                        <i class="bi bi-box-arrow-in-right me-1"></i>Entrar
                    </a>
                </li>

                <li class="nav-item d-none" id="myOrdersNavBtn">
                    <a class="nav-link fw-medium" href="#" onclick="showScreen('myOrders')">
                        <i class="bi bi-bag me-1"></i>Meus Pedidos
                    </a>
                </li>

                <li class="nav-item dropdown d-none" id="adminNavMenu">
                    <a class="nav-link fw-medium dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                        <i class="bi bi-shield-check me-1"></i>Admin
                    </a>
                    <ul class="dropdown-menu dropdown-menu-custom">
                        <li><a class="dropdown-item dropdown-item-custom" href="#" onclick="showScreen('adminCategories')">
                            <i class="bi bi-grid-3x3 me-2"></i>Categorias
                        </a></li>
                        <li><a class="dropdown-item dropdown-item-custom" href="#" onclick="showScreen('adminProducts')">
                            <i class="bi bi-box me-2"></i>Produtos
                        </a></li>
                        <li><a class="dropdown-item dropdown-item-custom" href="#" onclick="showScreen('adminStock')">
                            <i class="bi bi-plus-circle me-2"></i>Estoque
                        </a></li>
                    </ul>
                </li>

                <li class="nav-item d-none" id="userNavInfo">
                        <span class="nav-link fw-medium">
                            <i class="bi bi-person-circle me-1"></i>
                            <span id="navUserName"></span>
                        </span>
                </li>

                <li class="nav-item d-none" id="logoutNavBtn">
                    <a class="nav-link fw-medium" href="#" onclick="logout()">
                        <i class="bi bi-box-arrow-right me-1"></i>Sair
                    </a>
                </li>

                <li class="nav-item">
                    <button class="btn btn-outline-light rounded-pill px-3" onclick="openSupport()">
                        <i class="bi bi-headset me-2"></i>Suporte
                    </button>
                </li>

                <li class="nav-item position-relative">
                    <button class="btn btn-gradient rounded-pill px-4" onclick="showScreen('cart')" style="background: var(--gradient-primary); border: none; color: white;">
                        <i class="bi bi-cart3 me-2"></i>Carrinho
                        <span class="cart-count-badge" id="cartCount">0</span>
                    </button>
                </li>
            </ul>
        </div>
    </div>
</nav>

<!-- Main Content Container -->
<main class="container-fluid px-0">
    <!-- HOME SCREEN -->
    <div id="homeScreen" class="screen active">
        <!-- Hero Section -->
        <section class="hero-section">
            <div class="container text-center">
                <h1 class="display-3 fw-bold mb-4">
                    <span class="gradient-text">Produtos Digitais</span> Premium<br>
                    Para Gamers e Streamers
                </h1>
                <p class="lead mb-5 text-white-75" style="max-width: 800px; margin: 0 auto;">
                    Keys, Contas, Assinaturas e muito mais. Compre com segurança e receba instantaneamente.
                    Mais de 50.000 clientes satisfeitos em toda a América Latina.
                </p>

                <div class="hero-stats">
                    <div class="stat-card">
                        <div class="stat-number">4.9/5</div>
                        <div class="text-white-75 mt-2">AVALIAÇÕES</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">24h</div>
                        <div class="text-white-75 mt-2">ENTREGA</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">100%</div>
                        <div class="text-white-75 mt-2">SEGURO</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">50K+</div>
                        <div class="text-white-75 mt-2">CLIENTES</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Categories Section -->
        <section class="py-5">
            <div class="container">
                <h2 class="fw-bold mb-4">Explore por <span class="gradient-text">Categorias</span></h2>
                <div class="category-grid" id="categoriesGrid">
                    <!-- Categories will be loaded here -->
                </div>
            </div>
        </section>

        <!-- Products Section -->
        <section class="py-5 bg-dark">
            <div class="container">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2 class="fw-bold">Produtos em <span class="gradient-text">Destaque</span></h2>
                    <div class="dropdown">
                        <button class="btn btn-outline-light dropdown-toggle" type="button" data-bs-toggle="dropdown">
                            Ordenar por
                        </button>
                        <ul class="dropdown-menu dropdown-menu-custom">
                            <li><a class="dropdown-item dropdown-item-custom" href="#" onclick="sortProducts('price_asc')">Menor Preço</a></li>
                            <li><a class="dropdown-item dropdown-item-custom" href="#" onclick="sortProducts('price_desc')">Maior Preço</a></li>
                            <li><a class="dropdown-item dropdown-item-custom" href="#" onclick="sortProducts('stock')">Em Estoque</a></li>
                        </ul>
                    </div>
                </div>

                <div class="product-grid" id="productsGrid">
                    <!-- Products will be loaded here -->
                </div>
            </div>
        </section>
    </div>

    <!-- PRODUCT DETAILS SCREEN -->
    <div id="productDetailsScreen" class="screen">
        <section class="product-detail-section">
            <div class="container">
                <button class="btn btn-outline-light mb-4" onclick="showScreen('home')">
                    <i class="bi bi-arrow-left me-2"></i>Voltar para Produtos
                </button>

                <div class="row g-5">
                    <!-- Left Column - Product Info -->
                    <div class="col-lg-8">
                        <div class="product-image-container">
                            <img id="productDetailImage" src="" class="product-main-image" alt="Product Image">

                            <h1 id="productDetailTitle" class="fw-bold mb-3"></h1>

                            <div class="d-flex align-items-center gap-3 mb-4">
                                <span class="badge badge-category" id="productDetailCategory"></span>
                                <span class="badge badge-stock" id="productDetailStock"></span>
                            </div>

                            <div class="product-price display-4 fw-bold mb-4" id="productDetailPrice"></div>

                            <!-- Selected Plan Card -->
                            <div class="selected-plan-card">
                                <div class="selected-plan-title" id="selectedPlanTitle"></div>
                                <div class="selected-plan-price" id="selectedPlanPrice"></div>
                            </div>

                            <!-- Product Description -->
                            <div class="mt-4">
                                <h4 class="fw-bold mb-3">Descrição do Produto</h4>
                                <div id="productDetailDescription" class="text-white-75"></div>
                            </div>

                            <!-- Warning Box -->
                            <div class="warning-box">
                                <div class="warning-title">
                                    <i class="bi bi-exclamation-triangle"></i>
                                    ATENÇÃO IMPORTANTE
                                </div>
                                <p class="mb-0 text-white-75">
                                    • As credenciais são enviadas automaticamente após a confirmação do pagamento.<br>
                                    • Este produto é de uso pessoal apenas. Não compartilhe suas credenciais.<br>
                                    • Suporte disponível 24/7 via Discord em caso de problemas.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Right Column - Checkout Card -->
                    <div class="col-lg-4">
                        <div class="checkout-card-sticky">
                            <h3 class="fw-bold mb-4">Finalizar Compra</h3>

                            <div class="mb-4">
                                <label class="form-label">Quantidade:</label>
                                <div class="d-flex align-items-center gap-3">
                                    <button class="btn btn-outline-light" onclick="updateQuantity(-1)">
                                        <i class="bi bi-dash"></i>
                                    </button>
                                    <input type="number" class="form-control-custom text-center" id="productQuantity" value="1" min="1" readonly style="width: 80px;">
                                    <button class="btn btn-outline-light" onclick="updateQuantity(1)">
                                        <i class="bi bi-plus"></i>
                                    </button>
                                </div>
                            </div>

                            <button class="buy-now-btn" onclick="buyNow()">
                                <i class="bi bi-lightning-fill me-2"></i>COMPRAR AGORA
                            </button>

                            <button class="add-to-cart-btn" onclick="addToCart()">
                                <i class="bi bi-cart-plus me-2"></i>Adicionar ao Carrinho
                            </button>

                            <div class="guarantee-cards">
                                <div class="guarantee-card">
                                    <i class="bi bi-lightning-charge guarantee-icon"></i>
                                    <div>
                                        <div class="fw-bold">Entrega Imediata</div>
                                        <small class="text-white-75">Receba em até 5 minutos</small>
                                    </div>
                                </div>
                                <div class="guarantee-card">
                                    <i class="bi bi-shield-check guarantee-icon"></i>
                                    <div>
                                        <div class="fw-bold">Segurança Total</div>
                                        <small class="text-white-75">Garantia de 30 dias</small>
                                    </div>
                                </div>
                                <div class="guarantee-card">
                                    <i class="bi bi-qr-code guarantee-icon"></i>
                                    <div>
                                        <div class="fw-bold">Pagamento via PIX</div>
                                        <small class="text-white-75">Aprovação instantânea</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Related Products -->
                <div class="mt-5">
                    <h4 class="fw-bold mb-4">Produtos Relacionados</h4>
                    <div class="related-products-carousel" id="relatedProducts">
                        <!-- Related products will be loaded here -->
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- CHECKOUT SCREEN -->
    <div id="checkoutScreen" class="screen">
        <section class="checkout-section">
            <div class="container">
                <button class="btn btn-outline-light mb-4" onclick="showScreen('cart')">
                    <i class="bi bi-arrow-left me-2"></i>Voltar ao Carrinho
                </button>

                <div class="row g-5">
                    <!-- Left Column - Customer Info -->
                    <div class="col-lg-7">
                        <div class="glass-card p-4">
                            <h3 class="fw-bold mb-4">Informações do Pedido</h3>

                            <form id="checkoutForm">
                                <div class="mb-4">
                                    <label class="form-label fw-bold">Nome Completo</label>
                                    <input type="text" class="form-control-custom" id="customerName" required>
                                </div>

                                <div class="mb-4">
                                    <label class="form-label fw-bold">Email</label>
                                    <input type="email" class="form-control-custom" id="customerEmail" required>
                                    <small class="text-white-75">As credenciais serão enviadas para este email</small>
                                </div>

                                <div class="mb-4">
                                    <h5 class="fw-bold mb-3">Método de Pagamento</h5>

                                    <div class="payment-option-card active mb-3" onclick="selectPayment('pix')">
                                        <div class="d-flex align-items-center justify-content-between">
                                            <div>
                                                <div class="fw-bold mb-1">
                                                    <i class="bi bi-qr-code me-2"></i>PIX
                                                </div>
                                                <small class="text-white-75">Pagamento instantâneo</small>
                                            </div>
                                            <span class="pix-badge">
                                                    <i class="bi bi-check-circle me-1"></i>Aprovação Imediata
                                                </span>
                                        </div>
                                    </div>

                                    <div class="payment-option-card mb-3" onclick="selectPayment('credit')">
                                        <div>
                                            <div class="fw-bold mb-1">
                                                <i class="bi bi-credit-card me-2"></i>Cartão de Crédito
                                            </div>
                                            <small class="text-white-75">Até 12x sem juros</small>
                                        </div>
                                    </div>

                                    <input type="hidden" id="paymentMethod" value="pix">
                                </div>

                                <div class="form-check mb-4">
                                    <input class="form-check-input" type="checkbox" id="termsCheck" required>
                                    <label class="form-check-label text-white-75">
                                        Concordo com os <a href="#" class="text-warning">Termos de Serviço</a> e <a href="#" class="text-warning">Política de Privacidade</a>
                                    </label>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Right Column - Order Summary -->
                    <div class="col-lg-5">
                        <div class="order-summary-card">
                            <h3 class="fw-bold mb-4">Resumo do Pedido</h3>

                            <div id="orderSummaryItems">
                                <!-- Order items will be loaded here -->
                            </div>

                            <div class="mt-4">
                                <label class="form-label fw-bold">Cupom de Desconto</label>
                                <div class="coupon-input-group">
                                    <input type="text" class="form-control-custom border-0 bg-transparent" placeholder="Digite seu cupom" id="couponCode">
                                    <button class="btn btn-outline-light" onclick="applyCoupon()">Aplicar</button>
                                </div>
                            </div>

                            <div class="mt-4">
                                <div class="d-flex justify-content-between mb-2">
                                    <span class="text-white-75">Subtotal</span>
                                    <span id="orderSubtotal">R$ 0,00</span>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span class="text-white-75">Desconto</span>
                                    <span id="orderDiscount" class="text-success">R$ 0,00</span>
                                </div>
                                <hr class="my-3">
                                <div class="d-flex justify-content-between mb-4">
                                    <span class="fw-bold">Total</span>
                                    <span id="orderTotal" class="fw-bold fs-4 text-warning">R$ 0,00</span>
                                </div>

                                <button class="buy-now-btn w-100" onclick="proceedToPayment()">
                                    <i class="bi bi-lock-fill me-2"></i>FINALIZAR PAGAMENTO
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- PIX PAYMENT SCREEN -->
    <div id="pixPaymentScreen" class="screen">
        <section class="checkout-section">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-md-8">
                        <div class="order-summary-card">
                            <div class="text-center mb-4">
                                <div class="d-flex justify-content-center mb-3">
                                    <div class="loading-spinner"></div>
                                </div>
                                <h3 class="fw-bold">Aguardando Pagamento</h3>
                                <p class="text-white-75">Escaneie o QR Code ou copie o código PIX</p>
                            </div>

                            <div class="text-center mb-4">
                                <div class="bg-white p-4 rounded d-inline-block">
                                    <img id="pixQrCodeImg" src="" alt="QR Code PIX" style="max-width: 300px;">
                                </div>
                            </div>

                            <div class="mb-4">
                                <label class="form-label fw-bold">Código PIX (Copia e Cola)</label>
                                <div class="input-group">
                                    <input type="text" class="form-control-custom" id="pixCodeInput" readonly>
                                    <button class="btn btn-outline-light" onclick="copyPixCode()">
                                        <i class="bi bi-clipboard me-2"></i>Copiar
                                    </button>
                                </div>
                            </div>

                            <div class="text-center">
                                <p class="text-white-75" id="pixExpiresAt"></p>
                                <button class="btn btn-outline-light" onclick="checkPaymentStatus()">
                                    <i class="bi bi-arrow-clockwise me-2"></i>Verificar Status
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- CART SCREEN -->
    <div id="cartScreen" class="screen">
        <section class="py-5">
            <div class="container">
                <button class="btn btn-outline-light mb-4" onclick="showScreen('home')">
                    <i class="bi bi-arrow-left me-2"></i>Continuar Comprando
                </button>

                <h2 class="fw-bold mb-4">Meu Carrinho</h2>

                <div id="cartItemsContainer">
                    <!-- Cart items will be loaded here -->
                </div>

                <div class="text-end mt-5">
                    <h4>Total: <span id="cartTotal" class="fw-bold fs-3 text-warning">R$ 0,00</span></h4>
                    <button class="btn btn-gradient btn-lg mt-3 px-5 py-3" onclick="showScreen('checkout')" style="background: var(--gradient-primary); border: none; color: white;">
                        <i class="bi bi-lock-fill me-2"></i>Finalizar Pedido
                    </button>
                </div>
            </div>
        </section>
    </div>

    <!-- LOGIN SCREEN -->
    <div id="loginScreen" class="screen">
        <section class="py-5">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-md-6">
                        <div class="order-summary-card">
                            <div class="text-center mb-4">
                                <h2 class="fw-bold gradient-text">
                                    <i class="bi bi-controller me-2"></i>ByteMarket
                                </h2>
                                <p class="text-white-75">Acesse sua conta para comprar</p>
                            </div>

                            <div id="loginError" class="alert alert-danger d-none"></div>

                            <form onsubmit="handleLogin(event)">
                                <div class="mb-4">
                                    <label class="form-label fw-bold">Email</label>
                                    <input type="email" class="form-control-custom" id="loginEmail" required>
                                </div>

                                <div class="mb-4">
                                    <label class="form-label fw-bold">Senha</label>
                                    <input type="password" class="form-control-custom" id="loginPassword" required>
                                </div>

                                <button type="submit" class="btn btn-gradient w-100 py-3" style="background: var(--gradient-primary); border: none; color: white;">
                                    Entrar na Conta
                                </button>
                            </form>

                            <div class="text-center mt-4">
                                <p class="text-white-75 mb-0">
                                    Não tem conta?
                                    <a href="#" onclick="showScreen('register')" class="text-warning fw-bold">Cadastre-se</a>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- ADMIN CATEGORIES SCREEN -->
    <div id="adminCategoriesScreen" class="screen">
        <section class="admin-section">
            <div class="container">
                <button class="btn btn-outline-light mb-4" onclick="showScreen('home')">
                    <i class="bi bi-arrow-left me-2"></i>Voltar
                </button>

                <h2 class="fw-bold mb-4">
                    <i class="bi bi-grid-3x3 me-2"></i>Gerenciar Categorias
                </h2>

                <div class="row">
                    <div class="col-lg-8">
                        <div class="order-summary-card">
                            <table class="table table-dark table-hover">
                                <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Categoria</th>
                                    <th>URL da Imagem</th>
                                    <th>Ação</th>
                                </tr>
                                </thead>
                                <tbody id="adminCategoriesTable">
                                <!-- Categories will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="col-lg-4">
                        <div class="order-summary-card">
                            <h5 class="fw-bold mb-4">Editar Imagem da Categoria</h5>

                            <div class="mb-3">
                                <label class="form-label">Categoria</label>
                                <select class="form-control-custom" id="editCategorySelect">
                                    <option value="ASSINATURAS">Assinaturas Premium</option>
                                    <option value="KEYS">Keys Steam</option>
                                    <option value="DISCORD">Discord</option>
                                    <option value="CONTAS">Contas/Jogos</option>
                                    <option value="UTILIDADES">Utilidades</option>
                                    <option value="METODOS">Métodos</option>
                                </select>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">URL da Imagem</label>
                                <input type="url" class="form-control-custom" id="editCategoryImage"
                                       placeholder="https://exemplo.com/imagem.jpg">
                                <small class="text-white-75">Cole a URL da imagem de capa para esta categoria</small>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Preview</label>
                                <div class="text-center">
                                    <img id="categoryImagePreview" class="category-image-preview" src="" alt="Preview">
                                </div>
                            </div>

                            <button class="btn btn-gradient w-100" onclick="saveCategoryImage()"
                                    style="background: var(--gradient-primary); border: none; color: white;">
                                <i class="bi bi-save me-2"></i>Salvar Visual
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- ADMIN PRODUCTS SCREEN -->
    <div id="adminProductsScreen" class="screen">
        <section class="admin-section">
            <div class="container">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2 class="fw-bold">
                        <i class="bi bi-box me-2"></i>Gerenciar Produtos
                    </h2>
                    <button class="btn btn-gradient" onclick="showProductForm()"
                            style="background: var(--gradient-primary); border: none; color: white;">
                        <i class="bi bi-plus-circle me-2"></i>Novo Produto
                    </button>
                </div>

                <div class="order-summary-card">
                    <table class="table table-dark table-hover">
                        <thead>
                        <tr>
                            <th>ID</th>
                            <th>Título</th>
                            <th>Categoria</th>
                            <th>Preço</th>
                            <th>Estoque</th>
                            <th>Ações</th>
                        </tr>
                        </thead>
                        <tbody id="adminProductsTable">
                        <!-- Products will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
    </div>

    <!-- ADMIN PRODUCT FORM SCREEN -->
    <div id="adminProductFormScreen" class="screen">
        <section class="admin-section">
            <div class="container">
                <button class="btn btn-outline-light mb-4" onclick="showScreen('adminProducts')">
                    <i class="bi bi-arrow-left me-2"></i>Voltar
                </button>

                <h2 class="fw-bold mb-4" id="productFormTitle">
                    <i class="bi bi-plus-circle me-2"></i>Novo Produto
                </h2>

                <div class="order-summary-card">
                    <form onsubmit="saveProduct(event)">
                        <input type="hidden" id="editProductId">

                        <div class="row mb-4">
                            <div class="col-md-8">
                                <label class="form-label fw-bold">Título do Produto</label>
                                <input type="text" class="form-control-custom" id="productTitle" required>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label fw-bold">Categoria</label>
                                <select class="form-control-custom" id="productCategory" required>
                                    <option value="">Selecione...</option>
                                    <option value="ASSINATURAS">Assinaturas Premium</option>
                                    <option value="KEYS">Keys Steam</option>
                                    <option value="DISCORD">Discord</option>
                                    <option value="CONTAS">Contas/Jogos</option>
                                    <option value="UTILIDADES">Utilidades</option>
                                    <option value="METODOS">Métodos</option>
                                </select>
                            </div>
                        </div>

                        <div class="row mb-4">
                            <div class="col-md-6">
                                <label class="form-label fw-bold">Preço (R$)</label>
                                <input type="number" class="form-control-custom" id="productPrice" step="0.01" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-bold">URL da Imagem</label>
                                <input type="url" class="form-control-custom" id="productImage" required>
                            </div>
                        </div>

                        <div class="mb-4">
                            <label class="form-label fw-bold">Descrição (Rich Text)</label>
                            <div id="descriptionEditor"></div>
                        </div>

                        <button type="submit" class="btn btn-gradient w-100 py-3"
                                style="background: var(--gradient-primary); border: none; color: white;">
                            <i class="bi bi-save me-2"></i>Salvar Produto
                        </button>
                    </form>
                </div>
            </div>
        </section>
    </div>

    <!-- ADMIN STOCK SCREEN -->
    <div id="adminStockScreen" class="screen">
        <section class="admin-section">
            <div class="container">
                <button class="btn btn-outline-light mb-4" onclick="showScreen('adminProducts')">
                    <i class="bi bi-arrow-left me-2"></i>Voltar
                </button>

                <h2 class="fw-bold mb-4">
                    <i class="bi bi-plus-circle me-2"></i>Adicionar Estoque
                </h2>

                <div class="row">
                    <div class="col-lg-8">
                        <div class="order-summary-card">
                            <form onsubmit="addStock(event)">
                                <div class="mb-4">
                                    <label class="form-label fw-bold">Produto</label>
                                    <select class="form-control-custom" id="stockProductId" required>
                                        <!-- Products will be loaded here -->
                                    </select>
                                </div>

                                <div class="mb-4">
                                    <label class="form-label fw-bold">Itens de Estoque (um por linha)</label>
                                    <textarea class="form-control-custom" id="stockItems" rows="10" required
                                              placeholder="email@exemplo.com:senha123&#10;usuario:senha456&#10;chave-steam:ABC123-XYZ456"></textarea>
                                    <small class="text-white-75">
                                        Formato: login:senha ou email:senha<br>
                                        Cada linha será um item separado no estoque
                                    </small>
                                </div>

                                <button type="submit" class="btn btn-gradient w-100 py-3"
                                        style="background: var(--gradient-primary); border: none; color: white;">
                                    <i class="bi bi-plus-circle me-2"></i>Adicionar ao Estoque
                                </button>
                            </form>
                        </div>
                    </div>

                    <div class="col-lg-4">
                        <div class="order-summary-card">
                            <h5 class="fw-bold mb-4">Informações do Estoque</h5>
                            <div id="stockInfo">
                                <p class="text-white-75">Selecione um produto para ver informações do estoque</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
</main>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
    // Global Variables
    let currentUser = null;
    let authToken = localStorage.getItem('authToken');
    let cart = JSON.parse(localStorage.getItem('cart') || '[]');
    let allProducts = [];
    let currentProduct = null;
    let quillEditor = null;
    let paymentPolling = null;
    let selectedPayment = 'pix';
    let categoryImages = JSON.parse(localStorage.getItem('categoryImages') || '{}');

    // Category Default Images
    const defaultCategoryImages = {
        'ASSINATURAS': 'https://images.unsplash.com/photo-1611605698335-8b1569810432?q=80&w=1974&auto=format&fit=crop',
        'KEYS': 'https://images.unsplash.com/photo-1542751371-adc38448a05e?q=80&w=2070&auto=format&fit=crop',
        'DISCORD': 'https://images.unsplash.com/photo-1614680376573-df3480f0c6ff?q=80&w=1974&auto=format&fit=crop',
        'CONTAS': 'https://images.unsplash.com/photo-1550745165-9bc0b252726f?q=80&w=2070&auto=format&fit=crop',
        'UTILIDADES': 'https://images.unsplash.com/photo-1555774698-0b77e0d5fac6?q=80&w=2070&auto=format&fit=crop',
        'METODOS': 'https://images.unsplash.com/photo-1518709268805-4e9042af2176?q=80&w=2068&auto=format&fit=crop'
    };

    // Initialize Application
    document.addEventListener('DOMContentLoaded', () => {
        checkAuth();
        loadProducts();
        updateCartUI();
        loadCategories();

        // Preview category image on input change
        document.getElementById('editCategoryImage').addEventListener('input', function() {
            document.getElementById('categoryImagePreview').src = this.value;
        });

        // Preview product image on input change
        document.getElementById('productImage').addEventListener('input', function() {
            // Could add product image preview here
        });
    });

    // Authentication Functions
    function checkAuth() {
        if (authToken) {
            try {
                const payload = JSON.parse(atob(authToken.split('.')[1]));
                currentUser = {
                    email: payload.sub,
                    role: payload.role
                };

                // Update UI
                document.getElementById('loginNavBtn').classList.add('d-none');
                document.getElementById('myOrdersNavBtn').classList.remove('d-none');
                document.getElementById('userNavInfo').classList.remove('d-none');
                document.getElementById('logoutNavBtn').classList.remove('d-none');
                document.getElementById('navUserName').textContent = currentUser.email.split('@')[0];

                if (currentUser.role === 'ADMIN') {
                    document.getElementById('adminNavMenu').classList.remove('d-none');
                }
            } catch (e) {
                logout();
            }
        }
    }

    async function handleLogin(e) {
        e.preventDefault();
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;

        try {
            const response = await fetch('/auth/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password })
            });

            if (response.ok) {
                const data = await response.json();
                authToken = data.token;
                localStorage.setItem('authToken', authToken);

                Swal.fire({
                    icon: 'success',
                    title: 'Login realizado!',
                    text: 'Bem-vindo de volta!',
                    timer: 2000,
                    showConfirmButton: false
                });

                checkAuth();
                showScreen('home');
            } else {
                Swal.fire({
                    icon: 'error',
                    title: 'Erro no login',
                    text: 'Email ou senha incorretos',
                });
            }
        } catch (error) {
            Swal.fire({
                icon: 'error',
                title: 'Erro',
                text: 'Não foi possível conectar ao servidor',
            });
        }
    }

    function logout() {
        Swal.fire({
            title: 'Sair da conta?',
            text: 'Você será desconectado do sistema',
            icon: 'question',
            showCancelButton: true,
            confirmButtonColor: '#f97316',
            cancelButtonColor: '#6c757d',
            confirmButtonText: 'Sim, sair',
            cancelButtonText: 'Cancelar'
        }).then((result) => {
            if (result.isConfirmed) {
                authToken = null;
                currentUser = null;
                localStorage.removeItem('authToken');
                location.reload();
            }
        });
    }

    // Product Functions
    async function loadProducts() {
        try {
            const response = await fetch('/products');
            const data = await response.json();
            allProducts = data.content;

            renderProducts(allProducts);
            loadCategories();
        } catch (error) {
            console.error('Erro ao carregar produtos:', error);
            Swal.fire({
                icon: 'error',
                title: 'Erro',
                text: 'Não foi possível carregar os produtos',
            });
        }
    }

    function renderProducts(products) {
        const grid = document.getElementById('productsGrid');
        grid.innerHTML = '';

        products.forEach(product => {
            const isOutOfStock = product.availableStock === 0;

            grid.innerHTML += `
                    <div class="product-card" onclick="viewProductDetails(${product.id})">
                        ${isOutOfStock ? `
                            <div class="out-of-stock-overlay">
                                <div class="out-of-stock-badge">ESGOTADO</div>
                            </div>
                        ` : ''}

                        <img src="${product.imageUrl}" class="product-image" alt="${product.title}">
                        <div class="product-body">
                            <div class="product-title">${product.title}</div>
                            <div class="product-price">R$ ${product.price.toFixed(2)}</div>
                            <span class="product-stock${isOutOfStock ? ' out' : ''}">
                                ${isOutOfStock ? 'Esgotado' : product.availableStock + ' em estoque'}
                            </span>
                        </div>
                    </div>
                `;
        });
    }

    function loadCategories() {
        const container = document.getElementById('categoriesGrid');
        container.innerHTML = '';

        const categories = [
            { id: 'all', name: 'Todos', icon: '🎮' },
            { id: 'ASSINATURAS', name: 'Assinaturas', icon: '📺' },
            { id: 'KEYS', name: 'Keys Steam', icon: '🎮' },
            { id: 'DISCORD', name: 'Discord', icon: '💬' },
            { id: 'CONTAS', name: 'Contas/Jogos', icon: '👤' },
            { id: 'UTILIDADES', name: 'Utilidades', icon: '🔧' },
            { id: 'METODOS', name: 'Métodos', icon: '🎯' }
        ];

        categories.forEach(category => {
            const imageUrl = categoryImages[category.id] || defaultCategoryImages[category.id] || 'https://images.unsplash.com/photo-1511512578047-dfb367046420?q=80&w=2071&auto=format&fit=crop';

            container.innerHTML += `
                    <div class="category-card" onclick="filterByCategory('${category.id}')">
                        <img src="${imageUrl}" class="category-image" alt="${category.name}">
                        <div class="category-name">
                            ${category.icon} ${category.name}
                        </div>
                    </div>
                `;
        });
    }

    function filterByCategory(category) {
        // Remove active class from all cards
        document.querySelectorAll('.category-card').forEach(card => {
            card.classList.remove('active');
        });

        // Add active class to clicked card
        event.currentTarget.classList.add('active');

        if (category === 'all') {
            renderProducts(allProducts);
        } else {
            const filtered = allProducts.filter(p => p.type === category);
            renderProducts(filtered);
        }
    }

    function sortProducts(criteria) {
        let sorted = [...allProducts];

        switch(criteria) {
            case 'price_asc':
                sorted.sort((a, b) => a.price - b.price);
                break;
            case 'price_desc':
                sorted.sort((a, b) => b.price - a.price);
                break;
            case 'stock':
                sorted.sort((a, b) => b.availableStock - a.availableStock);
                break;
        }

        renderProducts(sorted);
    }

    // Product Details Functions
    async function viewProductDetails(id) {
        try {
            const response = await fetch(`/products/${id}`);
            currentProduct = await response.json();

            // Update UI
            document.getElementById('productDetailImage').src = currentProduct.imageUrl;
            document.getElementById('productDetailTitle').textContent = currentProduct.title;
            document.getElementById('productDetailCategory').textContent = currentProduct.type;
            document.getElementById('productDetailStock').textContent = `${currentProduct.availableStock} disponíveis`;
            document.getElementById('productDetailPrice').textContent = `R$ ${currentProduct.price.toFixed(2)}`;
            document.getElementById('selectedPlanTitle').textContent = currentProduct.title;
            document.getElementById('selectedPlanPrice').textContent = `R$ ${currentProduct.price.toFixed(2)}`;
            document.getElementById('productDetailDescription').innerHTML = currentProduct.description;

            // Load related products
            loadRelatedProducts(currentProduct.type);

            showScreen('productDetails');
        } catch (error) {
            console.error('Erro ao carregar produto:', error);
            Swal.fire({
                icon: 'error',
                title: 'Erro',
                text: 'Não foi possível carregar os detalhes do produto',
            });
        }
    }

    function loadRelatedProducts(category) {
        const related = allProducts
            .filter(p => p.type === category && p.id !== currentProduct.id)
            .slice(0, 5);

        const container = document.getElementById('relatedProducts');
        container.innerHTML = '';

        related.forEach(product => {
            container.innerHTML += `
                    <div class="product-card" style="min-width: 200px;" onclick="viewProductDetails(${product.id})">
                        <img src="${product.imageUrl}" class="product-image" alt="${product.title}" style="height: 120px;">
                        <div class="product-body">
                            <div class="product-title" style="font-size: 0.9rem;">${product.title}</div>
                            <div class="product-price" style="font-size: 1.2rem;">R$ ${product.price.toFixed(2)}</div>
                        </div>
                    </div>
                `;
        });
    }

    function updateQuantity(change) {
        const input = document.getElementById('productQuantity');
        const newValue = parseInt(input.value) + change;

        if (newValue >= 1 && newValue <= currentProduct.availableStock) {
            input.value = newValue;
        }
    }

    // Cart Functions
    function addToCart() {
        if (!currentProduct) return;

        const quantity = parseInt(document.getElementById('productQuantity').value);
        const existingIndex = cart.findIndex(item => item.id === currentProduct.id);

        if (existingIndex >= 0) {
            cart[existingIndex].quantity += quantity;
        } else {
            cart.push({
                id: currentProduct.id,
                title: currentProduct.title,
                price: currentProduct.price,
                image: currentProduct.imageUrl,
                quantity: quantity,
                maxStock: currentProduct.availableStock
            });
        }

        localStorage.setItem('cart', JSON.stringify(cart));
        updateCartUI();

        Swal.fire({
            icon: 'success',
            title: 'Adicionado ao carrinho!',
            text: 'Produto adicionado com sucesso',
            timer: 2000,
            showConfirmButton: false
        });
    }

    function buyNow() {
        addToCart();
        showScreen('checkout');
    }

    function updateCartUI() {
        const count = cart.reduce((sum, item) => sum + item.quantity, 0);
        document.getElementById('cartCount').textContent = count;

        if (document.getElementById('cartScreen').classList.contains('active')) {
            renderCart();
        }
    }

    function renderCart() {
        const container = document.getElementById('cartItemsContainer');

        if (cart.length === 0) {
            container.innerHTML = `
                    <div class="text-center py-5">
                        <i class="bi bi-cart-x display-1 text-white-50 mb-3"></i>
                        <h4 class="fw-bold">Seu carrinho está vazio</h4>
                        <p class="text-white-75 mb-4">Adicione produtos para continuar</p>
                        <button class="btn btn-gradient" onclick="showScreen('home')"
                                style="background: var(--gradient-primary); border: none; color: white;">
                            <i class="bi bi-shop me-2"></i>Ver Produtos
                        </button>
                    </div>
                `;
            document.getElementById('cartTotal').textContent = 'R$ 0,00';
            return;
        }

        container.innerHTML = '';
        let total = 0;

        cart.forEach((item, index) => {
            const itemTotal = item.price * item.quantity;
            total += itemTotal;

            container.innerHTML += `
                    <div class="glass-card p-4 mb-3">
                        <div class="row align-items-center">
                            <div class="col-md-2">
                                <img src="${item.image}" class="img-fluid rounded" alt="${item.title}" style="height: 80px; width: 100%; object-fit: cover;">
                            </div>
                            <div class="col-md-4">
                                <h6 class="fw-bold">${item.title}</h6>
                                <div class="text-warning">R$ ${item.price.toFixed(2)} cada</div>
                            </div>
                            <div class="col-md-3">
                                <div class="d-flex align-items-center gap-2">
                                    <button class="btn btn-outline-light btn-sm" onclick="updateCartItem(${index}, -1)">
                                        <i class="bi bi-dash"></i>
                                    </button>
                                    <span class="fw-bold">${item.quantity}</span>
                                    <button class="btn btn-outline-light btn-sm" onclick="updateCartItem(${index}, 1)">
                                        <i class="bi bi-plus"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="fw-bold fs-5">R$ ${itemTotal.toFixed(2)}</div>
                            </div>
                            <div class="col-md-1">
                                <button class="btn btn-outline-danger" onclick="removeCartItem(${index})">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
        });

        document.getElementById('cartTotal').textContent = `R$ ${total.toFixed(2)}`;
    }

    function updateCartItem(index, change) {
        const item = cart[index];
        const newQuantity = item.quantity + change;

        if (newQuantity >= 1 && newQuantity <= item.maxStock) {
            cart[index].quantity = newQuantity;
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartUI();
        } else if (newQuantity < 1) {
            removeCartItem(index);
        }
    }

    function removeCartItem(index) {
        Swal.fire({
            title: 'Remover item?',
            text: 'Este item será removido do carrinho',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#f97316',
            cancelButtonColor: '#6c757d',
            confirmButtonText: 'Sim, remover',
            cancelButtonText: 'Cancelar'
        }).then((result) => {
            if (result.isConfirmed) {
                cart.splice(index, 1);
                localStorage.setItem('cart', JSON.stringify(cart));
                updateCartUI();
            }
        });
    }

    // Checkout Functions
    function selectPayment(method) {
        selectedPayment = method;

        // Update UI
        document.querySelectorAll('.payment-option-card').forEach(card => {
            card.classList.remove('active');
        });

        event.currentTarget.classList.add('active');
        document.getElementById('paymentMethod').value = method;
    }

    function applyCoupon() {
        const code = document.getElementById('couponCode').value;

        if (code === 'BYTE10') {
            Swal.fire({
                icon: 'success',
                title: 'Cupom aplicado!',
                text: 'Desconto de 10% aplicado com sucesso',
            });
        } else {
            Swal.fire({
                icon: 'error',
                title: 'Cupom inválido',
                text: 'Este cupom não é válido ou já expirou',
            });
        }
    }

    async function proceedToPayment() {
        const name = document.getElementById('customerName').value;
        const email = document.getElementById('customerEmail').value;
        const termsCheck = document.getElementById('termsCheck').checked;

        if (!name || !email) {
            Swal.fire({
                icon: 'warning',
                title: 'Campos obrigatórios',
                text: 'Preencha seu nome e email para continuar',
            });
            return;
        }

        if (!termsCheck) {
            Swal.fire({
                icon: 'warning',
                title: 'Termos e condições',
                text: 'Você precisa aceitar os termos para continuar',
            });
            return;
        }

        if (!authToken) {
            Swal.fire({
                icon: 'warning',
                title: 'Login necessário',
                text: 'Faça login para finalizar a compra',
            }).then(() => {
                showScreen('login');
            });
            return;
        }

        try {
            const orderData = {
                userId: currentUser?.id || '00000000-0000-0000-0000-000000000000',
                deliveryEmail: email,
                items: cart.map(item => ({
                    productId: item.id,
                    quantity: item.quantity
                }))
            };

            const response = await fetch('/orders', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${authToken}`
                },
                body: JSON.stringify(orderData)
            });

            if (response.ok) {
                const order = await response.json();

                // Create PIX payment
                const paymentResponse = await fetch(`/payments/pix/orders/${order.id}`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (paymentResponse.ok) {
                    const payment = await paymentResponse.json();

                    // Clear cart
                    cart = [];
                    localStorage.setItem('cart', JSON.stringify(cart));
                    updateCartUI();

                    // Show PIX payment
                    showPixPayment(payment);
                }
            } else {
                const error = await response.json();
                Swal.fire({
                    icon: 'error',
                    title: 'Erro ao criar pedido',
                    text: error.message || 'Erro desconhecido',
                });
            }
        } catch (error) {
            console.error('Erro:', error);
            Swal.fire({
                icon: 'error',
                title: 'Erro',
                text: 'Não foi possível processar o pedido',
            });
        }
    }

    function showPixPayment(payment) {
        const qrCodeSrc = payment.pixQrCode.startsWith('data:image')
            ? payment.pixQrCode
            : `data:image/png;base64,${payment.pixQrCode}`;

        document.getElementById('pixQrCodeImg').src = qrCodeSrc;
        document.getElementById('pixCodeInput').value = payment.pixQrCodeText;

        const expiresAt = new Date(payment.expiresAt);
        document.getElementById('pixExpiresAt').textContent = `Expira em: ${expiresAt.toLocaleString('pt-BR')}`;

        showScreen('pixPayment');
        startPaymentPolling(payment.paymentId);
    }

    function startPaymentPolling(paymentId) {
        if (paymentPolling) clearInterval(paymentPolling);

        paymentPolling = setInterval(async () => {
            try {
                const response = await fetch(`/payments/${paymentId}`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    const payment = await response.json();

                    if (payment.status === 'APPROVED') {
                        clearInterval(paymentPolling);

                        Swal.fire({
                            icon: 'success',
                            title: 'Pagamento aprovado!',
                            text: 'Seu pedido foi confirmado e as credenciais foram enviadas para seu email',
                            confirmButtonColor: '#f97316'
                        }).then(() => {
                            showScreen('home');
                        });
                    }
                }
            } catch (error) {
                console.error('Erro ao verificar pagamento:', error);
            }
        }, 5000);
    }

    async function checkPaymentStatus() {
        // This would check the current payment status
        Swal.fire({
            icon: 'info',
            title: 'Verificando...',
            text: 'Aguarde enquanto verificamos o status do pagamento',
            timer: 2000,
            showConfirmButton: false
        });
    }

    function copyPixCode() {
        const input = document.getElementById('pixCodeInput');
        input.select();
        input.setSelectionRange(0, 99999);
        document.execCommand('copy');

        Swal.fire({
            icon: 'success',
            title: 'Código copiado!',
            text: 'O código PIX foi copiado para sua área de transferência',
            timer: 2000,
            showConfirmButton: false
        });
    }

    // Admin Functions
    function loadAdminCategories() {
        const tbody = document.getElementById('adminCategoriesTable');
        tbody.innerHTML = '';

        const categories = [
            { id: 'ASSINATURAS', name: 'Assinaturas Premium' },
            { id: 'KEYS', name: 'Keys Steam' },
            { id: 'DISCORD', name: 'Discord' },
            { id: 'CONTAS', name: 'Contas/Jogos' },
            { id: 'UTILIDADES', name: 'Utilidades' },
            { id: 'METODOS', name: 'Métodos' }
        ];

        categories.forEach(cat => {
            const imageUrl = categoryImages[cat.id] || defaultCategoryImages[cat.id] || '';

            tbody.innerHTML += `
                    <tr>
                        <td>${cat.id}</td>
                        <td>${cat.name}</td>
                        <td>
                            <input type="text" class="form-control-custom form-control-sm"
                                   value="${imageUrl}" readonly style="background: var(--bg-secondary);">
                        </td>
                        <td>
                            <button class="btn btn-sm btn-outline-warning" onclick="editCategory('${cat.id}')">
                                <i class="bi bi-pencil"></i>
                            </button>
                        </td>
                    </tr>
                `;
        });
    }

    function editCategory(categoryId) {
        document.getElementById('editCategorySelect').value = categoryId;

        const imageUrl = categoryImages[categoryId] || defaultCategoryImages[categoryId] || '';
        document.getElementById('editCategoryImage').value = imageUrl;
        document.getElementById('categoryImagePreview').src = imageUrl;
    }

    function saveCategoryImage() {
        const categoryId = document.getElementById('editCategorySelect').value;
        const imageUrl = document.getElementById('editCategoryImage').value;

        if (imageUrl) {
            categoryImages[categoryId] = imageUrl;
            localStorage.setItem('categoryImages', JSON.stringify(categoryImages));

            Swal.fire({
                icon: 'success',
                title: 'Imagem salva!',
                text: 'A imagem da categoria foi atualizada com sucesso',
            });

            loadCategories();
            loadAdminCategories();
        }
    }

    async function loadAdminProducts() {
        try {
            const response = await fetch('/products', {
                headers: { 'Authorization': `Bearer ${authToken}` }
            });
            const data = await response.json();

            const tbody = document.getElementById('adminProductsTable');
            tbody.innerHTML = '';

            data.content.forEach(product => {
                tbody.innerHTML += `
                        <tr>
                            <td>${product.id}</td>
                            <td>${product.title}</td>
                            <td>${product.type}</td>
                            <td>R$ ${product.price.toFixed(2)}</td>
                            <td>${product.availableStock}</td>
                            <td>
                                <button class="btn btn-sm btn-outline-warning me-2" onclick="editProduct(${product.id})">
                                    <i class="bi bi-pencil"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-danger" onclick="deleteProduct(${product.id})">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `;
            });
        } catch (error) {
            console.error('Erro:', error);
            Swal.fire({
                icon: 'error',
                title: 'Erro',
                text: 'Não foi possível carregar os produtos',
            });
        }
    }

    function showProductForm(productId = null) {
        if (productId) {
            document.getElementById('productFormTitle').innerHTML = '<i class="bi bi-pencil me-2"></i>Editar Produto';
            loadProductForEdit(productId);
        } else {
            document.getElementById('productFormTitle').innerHTML = '<i class="bi bi-plus-circle me-2"></i>Novo Produto';
            document.getElementById('editProductId').value = '';
            document.getElementById('productTitle').value = '';
            document.getElementById('productCategory').value = '';
            document.getElementById('productPrice').value = '';
            document.getElementById('productImage').value = '';

            if (quillEditor) {
                quillEditor.root.innerHTML = '';
            }
        }

        showScreen('adminProductForm');

        if (!quillEditor) {
            quillEditor = new Quill('#descriptionEditor', {
                theme: 'snow',
                modules: {
                    toolbar: [
                        ['bold', 'italic', 'underline'],
                        [{ 'header': [1, 2, 3, false] }],
                        [{ 'color': [] }, { 'background': [] }],
                        [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                        ['link', 'image'],
                        ['clean']
                    ]
                }
            });
        }
    }

    async function loadProductForEdit(id) {
        try {
            const response = await fetch(`/products/${id}`);
            const product = await response.json();

            document.getElementById('editProductId').value = product.id;
            document.getElementById('productTitle').value = product.title;
            document.getElementById('productCategory').value = product.type;
            document.getElementById('productPrice').value = product.price;
            document.getElementById('productImage').value = product.imageUrl;

            if (quillEditor) {
                quillEditor.root.innerHTML = product.description;
            }
        } catch (error) {
            console.error('Erro:', error);
            Swal.fire({
                icon: 'error',
                title: 'Erro',
                text: 'Não foi possível carregar o produto',
            });
        }
    }

    async function saveProduct(e) {
        e.preventDefault();

        const id = document.getElementById('editProductId').value;
        const data = {
            title: document.getElementById('productTitle').value,
            description: quillEditor.root.innerHTML,
            price: parseFloat(document.getElementById('productPrice').value),
            type: document.getElementById('productCategory').value,
            imageUrl: document.getElementById('productImage').value
        };

        try {
            const url = id ? `/admin/products/${id}` : '/admin/products';
            const method = id ? 'PUT' : 'POST';

            const response = await fetch(url, {
                method: method,
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${authToken}`
                },
                body: JSON.stringify(data)
            });

            if (response.ok) {
                Swal.fire({
                    icon: 'success',
                    title: 'Produto salvo!',
                    text: 'O produto foi salvo com sucesso',
                });

                showScreen('adminProducts');
                loadAdminProducts();
                loadProducts();
            } else {
                Swal.fire({
                    icon: 'error',
                    title: 'Erro ao salvar',
                    text: 'Não foi possível salvar o produto',
                });
            }
        } catch (error) {
            console.error('Erro:', error);
            Swal.fire({
                icon: 'error',
                title: 'Erro',
                text: 'Não foi possível salvar o produto',
            });
        }
    }

    async function deleteProduct(id) {
        Swal.fire({
            title: 'Excluir produto?',
            text: 'Esta ação não pode ser desfeita',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#f97316',
            cancelButtonColor: '#6c757d',
            confirmButtonText: 'Sim, excluir',
            cancelButtonText: 'Cancelar'
        }).then(async (result) => {
            if (result.isConfirmed) {
                try {
                    const response = await fetch(`/admin/products/${id}`, {
                        method: 'DELETE',
                        headers: { 'Authorization': `Bearer ${authToken}` }
                    });

                    if (response.ok) {
                        Swal.fire({
                            icon: 'success',
                            title: 'Excluído!',
                            text: 'Produto excluído com sucesso',
                        });

                        loadAdminProducts();
                        loadProducts();
                    }
                } catch (error) {
                    console.error('Erro ao excluir:', error);
                    Swal.fire({
                        icon: 'error',
                        title: 'Erro',
                        text: 'Não foi possível excluir o produto',
                    });
                }
            }
        });
    }

    async function loadStockProducts() {
        try {
            const response = await fetch('/products');
            const data = await response.json();

            const select = document.getElementById('stockProductId');
            select.innerHTML = '<option value="">Selecione um produto...</option>';

            data.content.forEach(product => {
                select.innerHTML += `
                        <option value="${product.id}">
                            ${product.title} (${product.availableStock} em estoque)
                        </option>
                    `;
            });

            // Add event listener to show stock info
            select.addEventListener('change', function() {
                if (this.value) {
                    const product = data.content.find(p => p.id == this.value);
                    if (product) {
                        document.getElementById('stockInfo').innerHTML = `
                                <div>
                                    <h6 class="fw-bold">${product.title}</h6>
                                    <p class="text-white-75">Estoque atual: ${product.availableStock} itens</p>
                                    <p class="text-white-75">Preço: R$ ${product.price.toFixed(2)}</p>
                                </div>
                            `;
                    }
                }
            });
        } catch (error) {
            console.error('Erro:', error);
            Swal.fire({
                icon: 'error',
                title: 'Erro',
                text: 'Não foi possível carregar os produtos',
            });
        }
    }

    async function addStock(e) {
        e.preventDefault();

        const productId = document.getElementById('stockProductId').value;
        const itemsText = document.getElementById('stockItems').value;

        if (!productId) {
            Swal.fire({
                icon: 'warning',
                title: 'Selecione um produto',
                text: 'Escolha um produto para adicionar estoque',
            });
            return;
        }

        const items = itemsText.split('\n')
            .filter(line => line.trim())
            .map(line => ({ content: line.trim() }));

        if (items.length === 0) {
            Swal.fire({
                icon: 'warning',
                title: 'Nenhum item',
                text: 'Digite pelo menos um item para adicionar ao estoque',
            });
            return;
        }

        try {
            const response = await fetch(`/admin/products/${productId}/stock`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${authToken}`
                },
                body: JSON.stringify(items)
            });

            if (response.ok) {
                Swal.fire({
                    icon: 'success',
                    title: 'Estoque adicionado!',
                    text: `${items.length} itens foram adicionados ao estoque`,
                });

                document.getElementById('stockItems').value = '';
                loadProducts();
            } else {
                Swal.fire({
                    icon: 'error',
                    title: 'Erro',
                    text: 'Não foi possível adicionar ao estoque',
                });
            }
        } catch (error) {
            console.error('Erro:', error);
            Swal.fire({
                icon: 'error',
                title: 'Erro',
                text: 'Não foi possível adicionar ao estoque',
            });
        }
    }

    // Utility Functions
    function openSupport() {
        window.open('https://discord.gg/seuservidor', '_blank');
    }

    function showScreen(screenName) {
        // Hide all screens
        document.querySelectorAll('.screen').forEach(screen => {
            screen.classList.remove('active');
        });

        // Show requested screen
        const screens = {
            'home': 'homeScreen',
            'productDetails': 'productDetailsScreen',
            'checkout': 'checkoutScreen',
            'pixPayment': 'pixPaymentScreen',
            'cart': 'cartScreen',
            'login': 'loginScreen',
            'adminCategories': 'adminCategoriesScreen',
            'adminProducts': 'adminProductsScreen',
            'adminProductForm': 'adminProductFormScreen',
            'adminStock': 'adminStockScreen'
        };

        const screenId = screens[screenName];
        if (screenId) {
            document.getElementById(screenId).classList.add('active');

            // Load specific data for screens
            if (screenName === 'cart') renderCart();
            if (screenName === 'adminCategories') loadAdminCategories();
            if (screenName === 'adminProducts') loadAdminProducts();
            if (screenName === 'adminStock') loadStockProducts();
        }

        // Scroll to top
        window.scrollTo(0, 0);
    }

    // Add to global scope for HTML onclick events
    window.showScreen = showScreen;
    window.logout = logout;
    window.openSupport = openSupport;
    window.viewProductDetails = viewProductDetails;
    window.filterByCategory = filterByCategory;
    window.sortProducts = sortProducts;
    window.updateQuantity = updateQuantity;
    window.addToCart = addToCart;
    window.buyNow = buyNow;
    window.updateCartItem = updateCartItem;
    window.removeCartItem = removeCartItem;
    window.selectPayment = selectPayment;
    window.applyCoupon = applyCoupon;
    window.proceedToPayment = proceedToPayment;
    window.copyPixCode = copyPixCode;
    window.checkPaymentStatus = checkPaymentStatus;
    window.editCategory = editCategory;
    window.saveCategoryImage = saveCategoryImage;
    window.showProductForm = showProductForm;
    window.editProduct = editProduct;
    window.deleteProduct = deleteProduct;
    window.addStock = addStock;
    window.handleLogin = handleLogin;
</script>
</body>
</html>